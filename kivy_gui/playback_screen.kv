#:kivy 1.11.1
#:import main main

# Please note the root.manager.current: this is how
# you can control the ScreenManager from kv. Each screen has by default a
# property manager that gives you the instance of the ScreenManager used.

#<PopoverWindow>:
#    Label:
#        text: "popover window"

<PlaybackScreen>:
#    play_stop_button: stop_play
    text_display: text_display
    cmd_input_box: command_input

    GridLayout:
        cols: 2
        id: _main_container
        width: root.width
        height: root.height

        # this relative layout allows popover to sit on top of box layout
        RelativeLayout:

            PopoverWindow:
                id: _popover_window
                size_hint: .8, .8
                pos: (large_text_layout.width - self.width) / 2, (large_text_layout.height - self.height) / 2

                PopoverLabel:
                    id: _popover_label
                    text: "popover text"

                    canvas.before:
                        Color:
                            rgba: (1,1,1,0.9)
                        Rectangle:
                            size: self.size
                            pos: self.pos

            LargeTextDisplayPanel:
                id: large_text_layout


                BoxLayout:
                    orientation: "vertical"

    #                MyKeyboardListener:
    #                    id: _v_keyboard

                    ScrollView:
                        do_scroll: (False, True)

                        ScrollingTextDisplayPanel:
                            id: text_display
                            text: "Scanner response..."


        BoxLayout:
            id: "right_side"
            orientation: "vertical"
            size_hint_x: .4

            MenuBar:
                id: "menu_layout"

                BoxLayout:
                    id: "button_row_container"
                    orientation: 'vertical'

                    # ------------ first row ------------- #
                    CommandLine:
                        id: command_input
                        text: "GLT,FL"
                        on_text_validate:
                            root.command_input(args[0])
#                            self.cancel_selection()  # gets rid of handles


                    # ------------ second row ------------- #
                    BoxLayout:
                        id: "second_row"
                        orientation: 'horizontal'

                        Button:
                            id: "menu_view"
                            text: "Get Menu View"
                            on_press: root.display_raw_scanner_output("MSI")

#                        Button:
#                            id: stop_play
#                            on_press:
#                                root.manager.transition.direction = 'right'
#                                root.manager.current = 'mode'
    #                        text: "Play Wav"
    #                        on_press: root.play_stop_btn()
    #                        on_press: app.sm.datawindow.zinger()

                        Button:
                            id: "gsi_output"
                            text: "View GSI Info"
                            on_press: root.display_raw_scanner_output("GSI")

                        Button:

                    # ---------- third row ---------- #
                    BoxLayout:
                        id: "third_row"
                        orientation: 'horizontal'

                        Button:
#                            popover_window: _popover_window
                            id: _hide_popover

                            text: "broken"
                            on_release:
                                # moves whole window offscreen
                                _popover_window.x = -root.width

                    BoxLayout:
                        id: "fourth_row"
                        orientation: 'horizontal'


                    BoxLayout:
                        id: "fifth_row"
                        orientation: 'horizontal'

                        Button:
                            id: scanner_status
                            text: "Connect to Scanner"
                            on_press: root.scanner_status_btn()

                        Button:
                            text: "Stop\nDisplay"
                            on_press: root.scanner_disconnect_btn()



                    BoxLayout:
                        id: "sixth_row"
                        orientation: 'horizontal'

                        Button:
                            text: 'Back\n<-'
                            on_press:
                                root.manager.transition.direction = 'right'
                                root.manager.current = 'datawindow'